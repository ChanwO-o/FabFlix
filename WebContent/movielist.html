<!doctype html>
<html lang="en">
<head>
	<title>Page Title</title>
	<link rel="stylesheet" href="reset.css"/>
	<link rel="stylesheet" href="common.css"/>
	<link rel="stylesheet" href="movielist.css"/>

	<link rel="stylesheet" href="search.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>

<div id="header">
	<span class="gradtext">FabFlix</span>
</div>
<div id="logout">
	<ul class="menu_list">
		<li class="home">
			<button type="button" class="btn_home" onclick="location.href='mainpage.html'">Home</button>
		</li>
		<li class="Cart">
			<button type="button" class="btn_cart" onclick="location.href='cart.html'">Checkout</button>
		</li>
		<li class="logout">
			<button type="button" class="btn_logout" onclick="location.href='login.html'">Logout</button>
		</li>
	</ul>
</div>

<br>
<div id="content" class="clearfix">
	<div>
		<div class="div_horizontal_buttons" style="float:right; margin-top:20px; margin-right:20px">
			<ul class="ul_horizontal_buttons">
				<li>
					<button type="button" onclick="check_order()">Rating Asc</button>
				</li>
				<li>
					<button type="button" onclick="check_order2()">Rating DSC</button>
				</li>
				<li>
					<button type="button" onclick="check_order3()">Title ASC</button>
				</li>
				<li>
					<button type="button" onclick="check_order4()">Title DSC</button>
				</li>
			</ul>
		</div>
	</div>
	<br>
	<div class="section_main">
		<div class="search_section">
			<div class="advancedsearch">
				<h2>Search Results</h2>
				<table id=movie_table class="table table-striped">
					<thead>
					<tr id=movie_list_columns>
						<!--<th>Poster</th>-->
						<th>Title</th>
						<th>Year</th>
						<th>Director</th>
						<th>Genres</th>
						<th>Stars</th>
						<th>Rating</th>
						<th></th> <!-- Add to cart button -->
					</tr>

					</thead>
					<tbody id=movie_table_body>
					</tbody>
				</table>

			</div>
			<!-- End Advanced Search -->
			<div class="button_group">
				<p style="text-align:right; margin-right:30px">Results Per Page:</p>
				<ul class="btn_group" style="float: right; margin-right:30px; margin-bottom: 30px; display: inline;">
					<li>
						<button type="page_10" onclick="page_10()"> 10</button>
					</li>
					<li>
						<button type="page_25" onclick="page_25()"> 25</button>
					</li>
					<li>
						<button type="page_50" onclick="page_50()"> 50</button>
					</li>
					<li>
						<button type="page_100" onclick="page_100()"> 100</button>
					</li>
				</ul>
			</div>
			<div class="button_group">
				<ul class="btn_group" style="float: left; margin-left: 30px; margin-bottom: 30px; display: inline;">
					<li>
						<button type="button" onclick="Prev()"> Prev</button>
					</li>
					<li>
						<button type="button" onclick="Next()"> Next</button>
					</li>

				</ul>
			</div>
		</div>
	</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script>
	function check_order() {
		let k = window.location.href;
		let first_sortby = getParameterByName('first_sortby');
		if (first_sortby != null && first_sortby.length > 1) {
			let second_sortby = getParameterByName('second_sortby');
			if (second_sortby != null && second_sortby.length > 1) {
				// console.log(window.location.search);
				//  console.log(first_sortby);
				// console.log(second_sortby);

				// console.log("NEW URL = " + u);
				let u = new URL(window.location.href);
				u.searchParams.set("first_sortby", second_sortby);
				u.searchParams.set("second_sortby", "rating_asc");
				location.replace(u);
				//console.log("u = " + u);

			} else {
				location.replace(window.location.search + "&second_sortby=rating_asc");
			}
		} else {
			location.replace(window.location.search + "&first_sortby=rating_asc");
			console.log("location = " + location);
		}
	}

	function check_order2() {
		let k = window.location.href;
		let first_sortby = getParameterByName('first_sortby');
		if (first_sortby != null && first_sortby.length > 1) {
			let second_sortby = getParameterByName('second_sortby');
			if (second_sortby != null && second_sortby.length > 1) {
				let u = new URL(window.location.href);
				u.searchParams.set("first_sortby", second_sortby);
				u.searchParams.set("second_sortby", "rating_dsc");
				location.replace(u);
			} else {
				location.replace(window.location.search + "&second_sortby=rating_dsc");
			}
		} else {
			location.replace(window.location.search + "&first_sortby=rating_dsc");
			console.log("location = " + location);
		}
	}

	function check_order3() {
		let k = window.location.href;
		let first_sortby = getParameterByName('first_sortby');
		if (first_sortby != null && first_sortby.length > 1) {
			let second_sortby = getParameterByName('second_sortby');
			if (second_sortby != null && second_sortby.length > 1) {
				let u = new URL(window.location.href);
				u.searchParams.set("first_sortby", second_sortby);
				u.searchParams.set("second_sortby", "title_asc");
				location.replace(u);
			} else {
				location.replace(window.location.search + "&second_sortby=title_asc");
			}
		} else {
			location.replace(window.location.search + "&first_sortby=title_asc");
			console.log("location = " + location);
		}
	}

	function check_order4() {
		let k = window.location.href;
		let first_sortby = getParameterByName('first_sortby');
		if (first_sortby != null && first_sortby.length > 1) {
			let second_sortby = getParameterByName('second_sortby');
			if (second_sortby != null && second_sortby.length > 1) {
				let u = new URL(window.location.href);
				u.searchParams.set("first_sortby", second_sortby);
				u.searchParams.set("second_sortby", "title_dsc");
				location.replace(u);
			} else {
				location.replace(window.location.search + "&second_sortby=title_dsc");
			}
		} else {
			location.replace(window.location.search + "&first_sortby=title_dsc");
			console.log("location = " + location);
		}
	}

	function Next() {
		let k = window.location.href;
		let first_sortby = getParameterByName('first_sortby');
		let pn = getParameterByName('pn');
		let pg = getParameterByName('pg');

		var no_more_search_results = document.getElementById("no_more_search_results");
		if (no_more_search_results != null) {
			alert('end of search results!'); // prevent user from going off page
			return;
		}

		if (first_sortby != null && first_sortby.length > 1) {
			let second_sortby = getParameterByName('second_sortby');
			if (second_sortby != null && second_sortby.length > 1) {
				let u = new URL(window.location.href);
				u.searchParams.set("pn", pn);
				let temp = parseInt(pg) + 1;
				var new_page = temp.toString();
				u.searchParams.set("pg", new_page);
				location.replace(u);
			} else {
				let u = new URL(window.location.href);
				u.searchParams.set("pn", pn);
				let temp = parseInt(pg) + 1;
				var new_page = temp.toString();
				u.searchParams.set("pg", new_page);
				location.replace(u);
			}
		} else {
			let u = new URL(window.location.href);
			u.searchParams.set("pn", pn);
			let temp = parseInt(pg) + 1;
			var new_page = temp.toString();
			u.searchParams.set("pg", new_page);
			location.replace(u);
			console.log("location = " + location);
		}
	}

	function Prev() {
		let first_sortby = getParameterByName('first_sortby');
		let pn = getParameterByName('pn');
		let pg = getParameterByName('pg');
		if (pg <= 1) {
			alert('already at first page!');
			return; // don't allow user to go below page 1
		}

		if (first_sortby != null && first_sortby.length > 1) {
			let second_sortby = getParameterByName('second_sortby');
			if (second_sortby != null && second_sortby.length > 1) {
				let u = new URL(window.location.href);
				u.searchParams.set("pn", pn);
				let temp = parseInt(pg) - 1;
				var new_page = temp.toString();
				u.searchParams.set("pg", new_page);
				location.replace(u);
			} else {
				let u = new URL(window.location.href);
				u.searchParams.set("pn", pn);
				let temp = parseInt(pg) - 1;
				var new_page = temp.toString();
				u.searchParams.set("pg", new_page);
				location.replace(u);
			}
		} else {
			let u = new URL(window.location.href);
			u.searchParams.set("pn", pn);
			let temp = parseInt(pg) - 1;
			var new_page = temp.toString();
			u.searchParams.set("pg", new_page);
			location.replace(u);
			console.log("location = " + location);
		}
	}

	function page_10() {
		let u = new URL(window.location.href);
		u.searchParams.set("pn", "10");
		location.replace(u);
	}

	function page_25() {
		let u = new URL(window.location.href);
		u.searchParams.set("pn", "25");
		location.replace(u);
	}

	function page_50() {
		let u = new URL(window.location.href);
		u.searchParams.set("pn", "50");
		location.replace(u);
	}

	function page_100() {
		let u = new URL(window.location.href);
		u.searchParams.set("pn", "100");
		location.replace(u);
	}
</script>
<script src="movielist.js"></script>
</body>

</html>
